{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Reservations - Foodie Heaven Restaurant</title>
    <link rel="icon" type="image/png" href="{% static 'restlogo.png' %}">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        h1, h2, h3 {
            font-family: 'Playfair Display', serif;
        }
         /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2563EB, #DB2777);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav id="navbar" class="fixed w-full z-50 transition-all duration-300 py-4 bg-white shadow-md">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <div class="text-4xl font-bold text-crimson-">
                    <i class="fas fa-utensils text-pink-500 mr-2"></i>
                    FOODIE HEAVEN ADMIN
                </div>
                <div class="hidden md:flex space-x-8">
                    <a href="{% url 'admin_dashboard' %}" class="text-pink-700 hover:text-blue-500 transition">Dashboard</a>
                    <a href="{% url 'index' %}" class="text-pink-700 hover:text-blue-500 transition">View Website</a>
                    <button id="logout-btn" class="text-pink-700 hover:text-blue-500 transition">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Manage Reservations Section -->
    <section class="py-20 mt-16">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold">Manage Reservations</h2>
                <div class="flex space-x-4">
                    <select id="filter-status" class="px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <input type="date" id="filter-date" class="px-4 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    <button id="filter-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition">
                        <i class="fas fa-filter mr-2"></i>Filter
                    </button>
                </div>
            </div>
            
            <!-- Reservations Table -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="overflow-x-auto">
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="px-4 py-2 text-left">ID</th>
                                <th class="px-4 py-2 text-left">Name</th>
                                <th class="px-4 py-2 text-left">Email</th>
                                <th class="px-4 py-2 text-left">Phone</th>
                                <th class="px-4 py-2 text-left">Date</th>
                                <th class="px-4 py-2 text-left">Time</th>
                                <th class="px-4 py-2 text-left">Guests</th>
                                <th class="px-4 py-2 text-left">Special Requests</th>
                                <th class="px-4 py-2 text-left">Status</th>
                                <th class="px-4 py-2 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="reservations-table-body">
                            <!-- Reservations will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>

    <!-- View Reservation Modal -->
    <div id="view-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Reservation Details</h3>
                <button id="close-view-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="reservation-details">
                <!-- Reservation details will be loaded here -->
            </div>
            
            <div class="flex justify-end mt-6">
                <button id="close-view-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample reservation data (in a real app, this would come from a database)
        const reservationsData = [
            {
                id: 1,
                name: "John Doe",
                email: "john@example.com",
                phone: "+91 9876543210",
                date: "2025-07-15",
                time: "7:00 PM",
                guests: 4,
                specialRequests: "Vegetarian options needed",
                status: "confirmed"
            },
            {
                id: 2,
                name: "Jane Smith",
                email: "jane@example.com",
                phone: "+91 9876543211",
                date: "2025-07-16",
                time: "8:30 PM",
                guests: 2,
                specialRequests: "Anniversary dinner",
                status: "pending"
            },
            {
                id: 3,
                name: "Robert Johnson",
                email: "robert@example.com",
                phone: "+91 9876543212",
                date: "2025-07-17",
                time: "6:00 PM",
                guests: 6,
                specialRequests: "Allergic to nuts",
                status: "confirmed"
            },
            {
                id: 4,
                name: "Emily Davis",
                email: "emily@example.com",
                phone: "+91 9876543213",
                date: "2025-07-18",
                time: "7:30 PM",
                guests: 3,
                specialRequests: "Window table preferred",
                status: "cancelled"
            }
        ];
        
        // Check if admin is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const isLoggedIn = localStorage.getItem('isAdminLoggedIn');
            
            if (isLoggedIn !== 'true') {
                // Redirect to login page if not logged in
                window.location.href = 'admin_login.html';
            } else {
                // Load all reservations
                loadReservations(reservationsData);
            }
        });
        
        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', function() {
            localStorage.removeItem('isAdminLoggedIn');
            window.location.href = 'admin_login.html';
        });
        
        // Load reservations
        function loadReservations(reservations) {
            const tableBody = document.getElementById('reservations-table-body');
            
            if (reservations.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="10" class="px-4 py-8 text-center text-gray-500">No reservations found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = reservations.map(reservation => `
                <tr class="border-b">
                    <td class="px-4 py-2">#${reservation.id}</td>
                    <td class="px-4 py-2 font-medium">${reservation.name}</td>
                    <td class="px-4 py-2">${reservation.email}</td>
                    <td class="px-4 py-2">${reservation.phone}</td>
                    <td class="px-4 py-2">${reservation.date}</td>
                    <td class="px-4 py-2">${reservation.time}</td>
                    <td class="px-4 py-2">${reservation.guests}</td>
                    <td class="px-4 py-2">${reservation.specialRequests || '-'}</td>
                    <td class="px-4 py-2">
                        ${getStatusBadge(reservation.status)}
                    </td>
                    <td class="px-4 py-2">
                        <button class="view-reservation text-blue-500 hover:text-blue-700 mr-2" data-id="${reservation.id}">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${reservation.status === 'pending' ? 
                            `<button class="confirm-reservation text-green-500 hover:text-green-700 mr-2" data-id="${reservation.id}">
                                <i class="fas fa-check"></i>
                            </button>` : ''
                        }
                        ${reservation.status !== 'cancelled' ? 
                            `<button class="cancel-reservation text-red-500 hover:text-red-700" data-id="${reservation.id}">
                                <i class="fas fa-times"></i>
                            </button>` : ''
                        }
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-reservation').forEach(button => {
                button.addEventListener('click', function() {
                    const reservationId = parseInt(this.getAttribute('data-id'));
                    viewReservation(reservationId);
                });
            });
            
            document.querySelectorAll('.confirm-reservation').forEach(button => {
                button.addEventListener('click', function() {
                    const reservationId = parseInt(this.getAttribute('data-id'));
                    confirmReservation(reservationId);
                });
            });
            
            document.querySelectorAll('.cancel-reservation').forEach(button => {
                button.addEventListener('click', function() {
                    const reservationId = parseInt(this.getAttribute('data-id'));
                    cancelReservation(reservationId);
                });
            });
        }
        
        // Get status badge HTML
        function getStatusBadge(status) {
            switch(status) {
                case 'confirmed':
                    return '<span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded">Confirmed</span>';
                case 'pending':
                    return '<span class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded">Pending</span>';
                case 'cancelled':
                    return '<span class="bg-red-100 text-red-800 text-xs font-semibold px-2.5 py-0.5 rounded">Cancelled</span>';
                default:
                    return '<span class="bg-gray-100 text-gray-800 text-xs font-semibold px-2.5 py-0.5 rounded">Unknown</span>';
            }
        }
        
        // View reservation details
        function viewReservation(reservationId) {
            const reservation = reservationsData.find(r => r.id === reservationId);
            
            if (reservation) {
                const detailsHtml = `
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span class="font-semibold">Reservation ID:</span>
                            <span>#${reservation.id}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Name:</span>
                            <span>${reservation.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Email:</span>
                            <span>${reservation.email}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Phone:</span>
                            <span>${reservation.phone}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Date:</span>
                            <span>${reservation.date}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Time:</span>
                            <span>${reservation.time}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Number of Guests:</span>
                            <span>${reservation.guests}</span>
                        </div>
                        <div>
                            <span class="font-semibold">Special Requests:</span>
                            <p class="mt-1">${reservation.specialRequests || 'None'}</p>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-semibold">Status:</span>
                            ${getStatusBadge(reservation.status)}
                        </div>
                    </div>
                `;
                
                document.getElementById('reservation-details').innerHTML = detailsHtml;
                document.getElementById('view-modal').classList.remove('hidden');
            }
        }
        
        // Confirm reservation
        function confirmReservation(reservationId) {
            const reservation = reservationsData.find(r => r.id === reservationId);
            
            if (reservation) {
                reservation.status = 'confirmed';
                loadReservations(reservationsData);
            }
        }
        
        // Cancel reservation
        function cancelReservation(reservationId) {
            if (confirm('Are you sure you want to cancel this reservation?')) {
                const reservation = reservationsData.find(r => r.id === reservationId);
                
                if (reservation) {
                    reservation.status = 'cancelled';
                    loadReservations(reservationsData);
                }
            }
        }
        
        // Filter reservations
        document.getElementById('filter-btn').addEventListener('click', function() {
            const statusFilter = document.getElementById('filter-status').value;
            const dateFilter = document.getElementById('filter-date').value;
            
            let filteredReservations = [...reservationsData];
            
            // Filter by status
            if (statusFilter !== 'all') {
                filteredReservations = filteredReservations.filter(r => r.status === statusFilter);
            }
            
            // Filter by date
            if (dateFilter) {
                filteredReservations = filteredReservations.filter(r => r.date === dateFilter);
            }
            
            loadReservations(filteredReservations);
        });
        
        // Close view modal
        document.getElementById('close-view-modal').addEventListener('click', function() {
            document.getElementById('view-modal').classList.add('hidden');
        });
        
        document.getElementById('close-view-btn').addEventListener('click', function() {
            document.getElementById('view-modal').classList.add('hidden');
        });
    </script>
</body>
</html>